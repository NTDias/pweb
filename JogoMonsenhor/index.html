<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Floresta Pixelada ‚Äî Edi√ß√£o Expandida</title>
    <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
    <style>
        :root{
            --neon:#00ff88;
            --bg:#07080b;
            --panel:#071a12;
            --accent:#00ffcc;
        }
        *{box-sizing:border-box}
        body{
            margin:0;
            font-family:'Press Start 2P', monospace;
            background: linear-gradient(180deg,#02030a 0%, #071016 50%, #000000 100%);
            color:var(--neon);
            display:flex;
            justify-content:center;
            padding:28px 12px;
            min-height:100vh;
        }

        /* CRT + scanlines */
        .screen{
            width:100%;
            max-width:900px;
            background:radial-gradient(circle at 10% 10%, rgba(0,255,136,0.03), transparent 20%),
                       linear-gradient(180deg, rgba(0,0,0,0.35), rgba(0,0,0,0.6));
            border:6px solid rgba(0,255,136,0.12);
            padding:20px;
            border-radius:10px;
            box-shadow:0 0 40px rgba(0,255,136,0.04);
            position:relative;
            overflow:hidden;
        }
        .scanlines{pointer-events:none;position:absolute;inset:0;background-image:repeating-linear-gradient(to bottom, rgba(0,0,0,0.06) 0px, rgba(0,0,0,0.06) 2px, rgba(0,0,0,0.15) 3px);} 
        /* subtle flicker */
        .vhs{animation:crtFlicker 6s infinite steps(2, end);} 
        @keyframes crtFlicker{0%{opacity:1}50%{opacity:0.98}100%{opacity:1}}

        header{display:flex;justify-content:space-between;align-items:center;margin-bottom:14px}
        h1{margin:0;font-size:18px;letter-spacing:1px}
        h1.glitch{position:relative}
        /* glitch effect */
        h1.glitch::before,h1.glitch::after{content:attr(data-text);position:absolute;left:0;top:0;overflow:hidden}
        h1.glitch::before{left:2px; text-shadow:-2px 0 var(--accent);clip-path:polygon(0 0,100% 0,100% 45%,0 45%)}
        h1.glitch::after{left:-2px;text-shadow:2px 0 #ff66cc;clip-path:polygon(0 55%,100% 55%,100% 100%,0 100%)}
        header .meta{font-size:10px}

        .panel{background:var(--panel);border:3px solid rgba(0,255,136,0.08);padding:16px;border-radius:6px}
        #hud{display:flex;gap:12px;align-items:center}
        .stat{padding:8px 12px;border:2px solid rgba(0,255,136,0.04);border-radius:6px;background:rgba(0,0,0,0.18);min-width:120px;text-align:center}
        .stat .label{font-size:9px;color:#9fffd7}
        .stat .value{font-size:14px;margin-top:6px}
        /* pulse when changed */
        .pulse{animation:pulse 700ms ease}
        @keyframes pulse{0%{transform:scale(1)}50%{transform:scale(1.06)}100%{transform:scale(1)}}

        #story{min-height:120px;font-size:12px;line-height:1.6}
        #question{margin-top:10px;font-size:12px}

        .choices{display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-top:12px}
        .choice-btn{background:#001100;border:3px solid var(--neon);color:var(--neon);padding:12px;font-size:11px;cursor:pointer;border-radius:6px;text-align:center}
        .choice-btn:hover{transform:translateY(-3px)}

        .small{font-size:10px;color:#9fffd7}

        footer{display:flex;justify-content:space-between;align-items:center;margin-top:14px}
        .controls button{background:transparent;border:2px solid rgba(0,255,136,0.08);color:var(--neon);padding:8px 10px;border-radius:6px;cursor:pointer}

        /* end screen */
        .end{padding:18px;text-align:center}
        .end .title{font-size:14px;margin-bottom:8px}
        .good{color:#7cff7c}
        .ok{color:#fff38f}
        .bad{color:#ff7c7c}

        /* responsive */
        @media(max-width:600px){.choices{grid-template-columns:1fr}.stat{min-width:auto}}
    </style>
</head>
<body>
    <div class="screen vhs" id="screen">
        <div class="scanlines"></div>
        <header>
            <h1 class="glitch" data-text="FLORESTA PIXELADA">FLORESTA PIXELADA</h1>
            <div class="meta small">ED. EXPANDIDA ‚Äî 8‚ÄëBIT SURVIVAL</div>
        </header>

        <div class="panel">
            <div id="hud" style="margin-bottom:12px">
                <div class="stat" id="stat-surv"><div class="label">SOBREVIV√äNCIA</div><div class="value" id="surv">100</div></div>
                <div class="stat" id="stat-fat"><div class="label">ESGOTAMENTO</div><div class="value" id="fat">0</div></div>
                <div class="stat"><div class="label">DIA</div><div class="value" id="day">1</div></div>
            </div>

            <div id="story" aria-live="polite">Carregando hist√≥ria...</div>
            <div id="question"></div>

            <div class="choices" id="choices"></div>

            <footer>
                <div class="small">Use as escolhas para moldar seu destino. Os efeitos aparecem apenas no HUD.</div>
                <div class="controls">
                    <button id="sfx-toggle">SFX: ON</button>
                    <button id="restart">REINICIAR</button>
                </div>
            </footer>
        </div>
    </div>

<script>
// GAME STATE
let surv = 100;
let fat = 0;
let day = 1;
let idx = 0;
let hasKnife = false;
let helpedWanderer = false;
let foundMap = false;
let sfxOn = true;

// DOM
const elStory = document.getElementById('story');
const elQuestion = document.getElementById('question');
const elChoices = document.getElementById('choices');
const elSurv = document.getElementById('surv');
const elFat = document.getElementById('fat');
const elDay = document.getElementById('day');
const statSurv = document.getElementById('stat-surv');
const statFat = document.getElementById('stat-fat');
const sfxToggle = document.getElementById('sfx-toggle');

// Simple 8-bit SFX generator
const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
function beep(f=440, t=0.08, type='square', vol=0.06){
    if(!sfxOn) return;
    const o = audioCtx.createOscillator();
    const g = audioCtx.createGain();
    o.type = type; o.frequency.value = f;
    g.gain.value = vol;
    o.connect(g); g.connect(audioCtx.destination);
    o.start();
    const now = audioCtx.currentTime;
    g.gain.setValueAtTime(vol, now);
    g.gain.exponentialRampToValueAtTime(0.001, now + t);
    o.stop(now + t + 0.02);
}

sfxToggle.onclick = ()=>{ sfxOn = !sfxOn; sfxToggle.textContent = sfxOn? 'SFX: ON':'SFX: OFF'; beep(600,0.06)}

document.getElementById('restart').onclick = ()=> location.reload();

// STORY NODES (>=10 choices)
const nodes = [
    {
        story: `Voc√™ acorda entre ra√≠zes grotescas. Um vento frio sussurra seu nome ‚Äî uma lembran√ßa apagada. √Ä sua frente h√° uma trilha antiga, marcada por pegadas recentes.`,
        q: `O que voc√™ faz?`,
        choices: [
            {label:'Seguir a trilha (investigar)', effect:()=>{surv+=5; fat+=5; foundMapChance();}},
            {label:'Ignorar e sair pela mata (evitar riscos)', effect:()=>{surv-=2; fat+=2;}}
        ]
    },
    {
        story: `A trilha leva a um acampamento abandonado ‚Äî barracas rasgadas e um mapa rasgado pregado em uma pedra.`,
        q:`Voc√™ tenta recuperar algo √∫til?`,
        choices:[
            {label:'Remexer nos restos (procurar ferramentas)', effect:()=>{surv+=8; fat+=6; hasKnife=true;}},
            {label:'S√≥ pegar o mapa e seguir', effect:()=>{foundMap=true; surv+=3;}}
        ]
    },
    {
        story:`O sol cai r√°pido. Voc√™ encontra uma clareira com frutos que brilham sob a lua ‚Äî parecem nutritivos, por√©m estranhos.`,
        q:`Comer os frutos?`,
        choices:[
            {label:'Comer com cautela', effect:()=>{ if(fat>30){surv-=25;} else {surv+=12} fat+=5 }},
            {label:'Ignorar (seguir em frente)', effect:()=>{surv-=3; fat+=2}}
        ]
    },
    {
        story:`Ru√≠dos nas sombras: um animal ‚Äî ou algu√©m? Voc√™ encontra um jovem vagante, ferido, pedindo ajuda.`,
        q:`Ajudar o vagante?`,
        choices:[
            {label:'Ajudar e carregar por um trecho', effect:()=>{surv-=10; fat+=20; helpedWanderer=true;}},
            {label:'Negar e seguir', effect:()=>{surv+=6;}}
        ]
    },
    {
        story:`O caminho se divide: um atalho atrav√©s de um p√¢ntano f√©tido e um desvio longo pela colina.`,
        q:`Qual caminho?`,
        choices:[
            {label:'P√¢ntano (curto)', effect:()=>{ if(hasKnife){surv+=15} else {surv-=20; fat+=10} }},
            {label:'Colina (seguro)', effect:()=>{fat-=8; surv+=4}}
        ]
    },
    {
        story:`Voc√™ encontra uma bandeira com s√≠mbolos antigos ‚Äî parece ser de uma expedi√ß√£o desaparecida. H√° instrumentos √∫teis por perto.`,
        q:`Investigar os equipamentos?`,
        choices:[
            {label:'Sim, procurar suprimentos', effect:()=>{surv+=10; fat+=5; hasKnife=true}},
            {label:'N√£o, pode ser armadilha', effect:()=>{surv-=2}}
        ]
    },
    {
        story:`A n√©voa espessa revela ru√≠nas de uma estrada e, ao longe, luzes intermitentes como se algu√©m sinalizasse.`,
        q:`Seguir a luz?`,
        choices:[
            {label:'Ir at√© a luz', effect:()=>{ if(foundMap){surv+=25} else {surv+=8; fat+=5} }},
            {label:'Evitar e procurar abrigo', effect:()=>{fat-=5; surv+=2}}
        ]
    },
    {
        story:`Voc√™ percebe pegadas frescas ao lado da trilha ‚Äî talvez outra pessoa esteja perto.`,
        q:`Voc√™ tenta rastrear as pegadas?`,
        choices:[
            {label:'Seguir rastros', effect:()=>{ if(helpedWanderer){surv+=12} else {surv-=5; fat+=5} }},
            {label:'Destruir rastros e disfar√ßar', effect:()=>{fat+=3; surv+=1}}
        ]
    },
    {
        story:`O ar fica denso. Um pulsar de luz percorre a floresta ‚Äî √© um sinal de fuma√ßa ao leste e fogo contido a oeste.`,
        q:`Para onde ir?`,
        choices:[
            {label:'Fuma√ßa (poss√≠vel resgate)', effect:()=>{surv+=20; fat+=-10}},
            {label:'Fogo (acampamento)', effect:()=>{surv+=10; fat-=8}}
        ]
    },
    {
        story:`√öltima barreira: uma cerca e um port√£o antigo. Algu√©m parece ter fechado o acesso.`,
        q:`Como tentar sair?`,
        choices:[
            {label:'Pular a cerca', effect:()=>{ if(fat>=40){surv-=50} else {surv+=20} }},
            {label:'Buscar passagem segura', effect:()=>{surv+=10; fat-=5}}
        ]
    }
];

// start
function renderNode(i){
    const n = nodes[i];
    elStory.textContent = n.story;
    elQuestion.textContent = ' ' + n.q;
    elChoices.innerHTML = '';

    n.choices.forEach((c, idxChoice)=>{
        const b = document.createElement('button');
        b.className='choice-btn';
        b.textContent = c.label;
        b.onclick = ()=>{
            // play sfx with variation
            beep(250 + Math.random()*900, 0.06, 'square', 0.06);
            // apply effect safely
            try{ c.effect(); }catch(e){console.warn(e)}
            // some side-effects detection
            if(nodes[i] === nodes[1] && idxChoice===0) hasKnife=true; // ensure
            updateStats();
            // small HUD animation
            statSurv.classList.add('pulse'); statFat.classList.add('pulse');
            setTimeout(()=>{statSurv.classList.remove('pulse'); statFat.classList.remove('pulse')},700);

            // next node
            day++;
            idx++;
            if(idx < nodes.length) setTimeout(()=>renderNode(idx), 420);
            else setTimeout(()=>endGame(), 600);
        };
        elChoices.appendChild(b);
    });
}

function updateStats(){
    // clamp values
    if(surv < -100) surv = -100;
    if(surv > 999) surv = 999;
    if(fat < -50) fat = -50;
    if(fat > 999) fat = 999;
    elSurv.textContent = Math.round(surv);
    elFat.textContent = Math.round(fat);
    elDay.textContent = day;
}

function foundMapChance(){ if(Math.random()<0.35){ foundMap=true; surv+=3; } }

function endGame(){
    // compute final modifier
    const finalScore = surv - fat*0.6;
    elStory.innerHTML = '';
    elQuestion.textContent = '';
    elChoices.innerHTML = '';

    const endDiv = document.createElement('div');
    endDiv.className='end panel';
    const title = document.createElement('div'); title.className='title';

    // multiple endings
    if(finalScore >= 140 && fat < 40){
        title.innerHTML = '<div class="good">üèÜ FINAL EXCELENTE ‚Äî ESCAPOU VIVO E PRECISO</div>';
        endDiv.innerHTML += `<p>Voc√™ alcan√ßou a borda com recursos e mente afiada. Sua hist√≥ria se tornar√° lenda entre os que voltarem √† trilha.</p>`;
    } else if(finalScore >= 90){
        title.innerHTML = '<div class="ok">‚úÖ FINAL BOM ‚Äî SOBREVIVENTE RESILIENTE</div>';
        endDiv.innerHTML += `<p>Voc√™ saiu da floresta, mas com cicatrizes. Algumas escolhas foram custosas, outras s√°bias.</p>`;
    } else if(surv <= 0){
        title.innerHTML = '<div class="bad">‚úñ MORTE NA FLORESTA</div>';
        endDiv.innerHTML += `<p>Suas for√ßas n√£o foram suficientes. A floresta √© implac√°vel ‚Äî o eco do seu nome some na n√©voa.</p>`;
    } else if(fat >= 80){
        title.innerHTML = '<div class="bad">‚õî EXAUST√ÉO ‚Äî COLAPSO</div>';
        endDiv.innerHTML += `<p>Seu corpo rendeu antes do destino. Exaust√£o venceu sua vontade.</p>`;
    } else if(helpedWanderer && foundMap){
        title.innerHTML = '<div class="good">ü§ù HER√ìI DA TRILHA</div>';
        endDiv.innerHTML += `<p>Ajudar outros garantiu aliados e informa√ß√£o ‚Äî voc√™ encontrou uma sa√≠da com dignidade.</p>`;
    } else {
        title.innerHTML = '<div class="ok">üîé FIM AMBIGUO</div>';
        endDiv.innerHTML += `<p>Voc√™ sobreviveu, mas a floresta levou parte do seu passado. Nem tudo √© claro ‚Äî algumas perguntas permanecem sem resposta.</p>`;
    }

    // summary
    endDiv.innerHTML = title.outerHTML + endDiv.innerHTML + `<p><strong>Resumo:</strong> Sobreviv√™ncia ${Math.round(surv)} ‚Äî Esgotamento ${Math.round(fat)} ‚Äî Escore final ${Math.round(finalScore)}</p>`;
    endDiv.innerHTML += `<p><button class='choice-btn' onclick='location.reload()'>JOGAR NOVAMENTE</button></p>`;

    document.querySelector('.panel').appendChild(endDiv);

    // final fanfare
    beep(880,0.14,'square',0.08); setTimeout(()=>beep(660,0.12,'square',0.06),160);
}

// initial render
updateStats(); renderNode(idx);

</script>
</body>
</html>
